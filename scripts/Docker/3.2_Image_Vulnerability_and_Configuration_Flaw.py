import os
import modules as m

print("[#############       ]")
vul=0; res=1; res_init=1

m.init()

title="3.2. Images - Image Vulnerability and Configuration Flaw"
m.BAR()
m.CODE(title) # 이미지 취약점 및 구성 결함
m.BAR()

print("Step2. 컨테이너 내 패키지 검증")
packages = os.popen("docker ps --quiet").read().split()

for package in packages:
    check = os.popen('docker exec '+package+' rpm -qa').read()
    if (check.find("not found")) == -1:
        res=0

ret = m.res_chk(res, vul, res_init, title, "\
Step2. 컨테이너 내 패키지 검증 \n\
불필요한 패키지 및 보안 패치가 되어 있지 않은 패키지가 존재합니다.\n\
사용하지 않는 패키지는 삭제하고, 필요한 패키지는 보안 패치가 적용된 패키지를 이용하여\
이미지를 재생성해야 합니다.")
res_init = ret[0]; vul = ret[1]

m.BAR()
m.vul_chk(vul)
m.END()